<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Redis笔记 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Redis1. Redis 概念：Redis 是一款高性能的 NoSQL 系列的非关系型数据库  什么是 NoSQL NoSQL（Not Only SQL），是一项全新的数据库理念，泛指非关系型的数据库 随着互联网 web 2.0 网站的兴起，传统的关系数据库在应付 web 2.0 网站，特别是超大规模和高并发的 SNS 类型的 web 2.0 纯动态网站已经显得力不从心，暴露了很多难以克服的问题">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis笔记">
<meta property="og:url" content="http://example.com/2021/11/18/Redis/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Redis1. Redis 概念：Redis 是一款高性能的 NoSQL 系列的非关系型数据库  什么是 NoSQL NoSQL（Not Only SQL），是一项全新的数据库理念，泛指非关系型的数据库 随着互联网 web 2.0 网站的兴起，传统的关系数据库在应付 web 2.0 网站，特别是超大规模和高并发的 SNS 类型的 web 2.0 纯动态网站已经显得力不从心，暴露了很多难以克服的问题">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-18T12:57:05.782Z">
<meta property="article:modified_time" content="2021-11-18T12:59:40.491Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/86187/Desktop/Java笔记/图片/Snipaste_2021-09-26_11-45-51.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/18/Redis/" class="article-date">
  <time class="dt-published" datetime="2021-11-18T12:57:05.782Z" itemprop="datePublished">2021-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Redis笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="1-Redis"><a href="#1-Redis" class="headerlink" title="1. Redis"></a>1. Redis</h2><ol>
<li><p>概念：Redis 是一款高性能的 NoSQL 系列的非关系型数据库</p>
<ol>
<li>什么是 NoSQL<ul>
<li>NoSQL（Not Only SQL），是一项全新的数据库理念，泛指非关系型的数据库</li>
<li>随着互联网 web 2.0 网站的兴起，传统的关系数据库在应付 web 2.0 网站，特别是超大规模和高并发的 SNS 类型的 web 2.0 纯动态网站已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。NoSQL 数据库的产生就是为了解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题</li>
</ul>
</li>
<li>非关系型数据库和关系型数据库的比较<ul>
<li>优点<ol>
<li>成本：NoSQL 数据库简单易部署，基本都是开源软件，不需要像使用 Oracle 那样花费大量成本购买使用，相比关系型数据库价格便宜</li>
<li>查询速度：NoSQL 数据库将数据存储于缓存之中，关系型数据库将数据存储在硬盘中，自然查询速度远不及 NoSQL 数据库</li>
<li>存储数据的格式：NoSQL 的存储格式是 key, value 形式、文档形式、图片形式等等，所以可以存储基础类型以及对象或者是集合等各种格式，而关系型数据库则只支持基础类型</li>
<li>扩展性：关系型数据库有类似 join 这样的多表查询机制的限制，导致扩展很艰难</li>
</ol>
</li>
<li>缺点<ol>
<li>维护的工具和资料有限，因为 NoSQL 是属于新的技术，不能和关系型数据库十几年的技术同日而语</li>
<li>不提供对 SQL 的支持，如果不支持 SQL 这样的工业标准，将产生一定用户的学习和使用成本</li>
<li>不提供关系型数据库对事务的处理</li>
</ol>
</li>
</ul>
</li>
<li>非关系型数据库的作用：作为缓存，加快读取速度</li>
</ol>
<p><img src="https://z3.ax1x.com/2021/11/18/ITqDaj.png"></p>
<ol start="4">
<li><p>主流的 NoSQL 产品</p>
<ol>
<li><p>键值 (Key-Value) 存储数据库</p>
<p>Tokyo Cabinet/Tyrant、Redis、Voldemort、Berkeley DB</p>
</li>
<li><p>列存储数据库</p>
<p>Cassandra、HBase、Riak</p>
</li>
<li><p>文档型数据库</p>
<p>CouchDB、MongoDB</p>
</li>
<li><p>图形 (Graph) 数据库</p>
<p>Neo4J、InfoGrid、Infinite Graph</p>
</li>
</ol>
</li>
<li><p>什么是 Redis</p>
<p>Redis是用C语言开发的一个开源的高性能键值对（key-value）数据库，官方提供测试数据，50个并发执行100000个请求,读的速度是110000次/s,写的速度是81000次/s ，且Redis通过提供多种键值数据类型来适应不同场景下的存储需求，目前为止Redis支持的键值数据类型如下：</p>
<pre><code>        1) 字符串类型 string
        2) 哈希类型 hash
        3) 列表类型 list
        4) 集合类型 set
        5) 有序集合类型 sortedset
</code></pre>
</li>
<li><p>Redis 的应用场景</p>
<ul>
<li>缓存（数据查询、短连接、新闻内容、商品内容等等）</li>
<li>聊天室的在线好友列表</li>
<li>任务队列（秒杀、抢购、12306等等）</li>
<li>应用排行榜</li>
<li>网站访问统计</li>
<li>数据过期处理（可以精确到毫秒）</li>
<li>分布式集群架构中的 session 分离</li>
</ul>
</li>
<li><p>总结</p>
<ul>
<li>关系型数据库与 NoSQL 数据库并非对立而是互补的关系，即通常情况下使用关系型数据库，在适合使用 NoSQL 的时候使用 NoSQL 数据库，让 NoSQL 数据库对关系型数据库的不足进行弥补</li>
<li>一般会将数据存储在关系型数据库中，在 NoSQL 数据库中备份存储关系型数据库的数据（缓存）</li>
</ul>
</li>
</ol>
</li>
<li><p>安装</p>
<p>解压直接可以使用</p>
<p>需要用到的文件：</p>
<ul>
<li>redis.windows.conf：配置文件</li>
<li>redis-cli.exe：Redis 的客户端</li>
<li>redis-server.exe：Redis 的服务器端</li>
</ul>
</li>
<li><p>命令操作</p>
<ol>
<li>Redis 的数据结构<ul>
<li>Redis 存储的是 key, value 格式的数据，其中 key 都是字符串，value 有 5 种不同的数据结构<ul>
<li>value 的数据结构<ol>
<li>字符串类型 string</li>
<li>哈希类型 hash（相当于 Map）</li>
<li>列表类型 list（相当于 LinkedList）</li>
<li>集合类型 set</li>
<li>有序集合类型 sortedset</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>字符串类型 string<ol>
<li>存储：set key value</li>
<li>获取：get key</li>
<li>删除：del key</li>
</ol>
</li>
<li>哈希类型 hash<ol>
<li>存储：hset key field value</li>
<li>获取<ul>
<li>hget key field：获取指定的 field 对应的值</li>
<li>hgetall key：获取所有的 field 和对应的值</li>
</ul>
</li>
<li>删除：hdel key field</li>
</ol>
</li>
<li>列表类型 list<ol>
<li>添加<ul>
<li>lpush key value：将元素加入到列表左边</li>
<li>rpush key value：将元素加入到列表右边</li>
</ul>
</li>
<li>获取<ul>
<li>lrange key start end：范围获取（如果想要获取全部，则 lrange key 0 -1）</li>
</ul>
</li>
<li>删除<ul>
<li>lpop key：删除列表最左边的元素，并将元素返回</li>
<li>rpop key：删除列表最右边的元素，并将元素返回</li>
</ul>
</li>
</ol>
</li>
<li>集合类型 set<ol>
<li>存储：sadd key value</li>
<li>获取：smembers key（获取 set 集合中所有元素）</li>
<li>删除：srem key value</li>
</ol>
</li>
<li>有序集合类型 sortedset<ol>
<li>存储：zadd key score value</li>
<li>获取：zrange key start end</li>
<li>删除：zrem key value</li>
</ol>
</li>
<li>通用命令<ol>
<li>keys *：查询所有的 key</li>
<li>type key：获取 key 所对应的 value 的类型</li>
<li>del key：删除指定的 key 及对应 value</li>
</ol>
</li>
</ol>
</li>
<li><p>持久化</p>
<ol>
<li><p>Redis 是一个<u>内存</u>数据库，当 Redis 服务器重启，或者电脑重启后，数据会丢失。我们可以将 Redis 中的内存数据持久化存储到硬盘文件中</p>
</li>
<li><p>Redis 的持久化机制</p>
<ol>
<li><p>RDB</p>
<ul>
<li><p>默认方式，不需要进行配置，默认就使用这种机制</p>
</li>
<li><p>在一定的间隔时间后，检测 key 的变化情况，如果满足条件就持久化数据</p>
</li>
<li><p>步骤</p>
<ol>
<li><p>编辑 redis.windows.conf 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure></li>
<li><p>在命令行中启动 Redis 服务器，并指定配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\redis-2.8.9&gt;redis-server.exe  redis.windows.conf</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li><p>AOF</p>
<ul>
<li><p>日志记录的方式，可以记录每一条命令的操作，可以每一次操作后就持久化数据</p>
</li>
<li><p>步骤</p>
<ol>
<li><p>编辑 redis.windows.conf 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly no</span><br></pre></td></tr></table></figure>

<p>↓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># no: 不进行持久化</span><br><span class="line"># always: 每一次操作都进行一次持久化</span><br><span class="line"># everysec: 每隔一秒进行一次持久化</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br></pre></td></tr></table></figure>

<p>要用哪种就把哪一行的注释打开</p>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li><p>Java 客户端：Jedis</p>
<ul>
<li><p>Jedis：一款 Java 操作 Redis 数据库的工具</p>
</li>
<li><p>快速入门</p>
<ol>
<li>导入 jar 包</li>
<li>获取连接</li>
<li>操作</li>
<li>关闭连接</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 获取连接</span></span><br><span class="line"><span class="comment">// 如果使用空参构造，则默认就是 localhost 和 6379。所以连接本机可以省略不写</span></span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 操作</span></span><br><span class="line">jedis.set(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 关闭连接</span></span><br><span class="line">jedis.close();</span><br></pre></td></tr></table></figure></li>
<li><p>Jedis 操作各种数据</p>
<ul>
<li>方法名和之前的命令一模一样，所以下方不再详细列出</li>
</ul>
<ol>
<li>字符串类型 string<ul>
<li>setex(key, expireTime, value)：在 expireTime 秒后自动删除该数据</li>
</ul>
</li>
<li>哈希类型 hash</li>
<li>列表类型 list</li>
<li>集合类型 set</li>
<li>有序集合类型 sortedset</li>
</ol>
</li>
<li><p>Jedis 连接池：JedisPool</p>
<ul>
<li>使用<ol>
<li>创建 JedisPool 连接池对象</li>
<li>调用方法 getResource() 获取 Jedis 连接</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="2-案例：加载下拉列表"><a href="#2-案例：加载下拉列表" class="headerlink" title="2. 案例：加载下拉列表"></a>2. 案例：加载下拉列表</h2><ol>
<li><p>需求</p>
<ol>
<li>提供 index.html 页面，页面中有一个内容为省份的下拉列表</li>
<li>当页面加载完成后，发送 Ajax 请求，加载所有省份</li>
</ol>
</li>
<li><p>实现</p>
</li>
</ol>
<p><img src="\images\Snipaste_2021-09-29_01-03-04.png"></p>
<ul>
<li><p>ProvinceServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findAllJson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Jedis jedis = JedisPoolUtils.getJedis();</span><br><span class="line"></span><br><span class="line">    String json = jedis.get(<span class="string">&quot;provinces&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (json == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(json)) &#123; <span class="comment">// Redis 中无缓存</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Redis中无缓存，查询MySQL数据库...&quot;</span>);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Province&gt; provinces = provinceDao.findAll();</span><br><span class="line">            json = objectMapper.writeValueAsString(provinces);</span><br><span class="line">            jedis.set(<span class="string">&quot;provinces&quot;</span>, json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// Redis 中有缓存</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Redis中有缓存，直接拿来使用...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    jedis.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>省份列表.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&quot;provinceServlet&quot;</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> provinces = $(<span class="string">&quot;#provinces&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $(data).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> option = <span class="string">&quot;&lt;option name=&#x27;&quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;&lt;/option&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            provinces.append(option);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><p>注意</p>
<ul>
<li><p>使用 Redis 来缓存一些不经常发生变化的数据</p>
</li>
<li><p>数据库的数据一旦发生改变，则需要更新缓存</p>
<ul>
<li>在 service 类中的增、删、改方法中，要将 Redis 中的对应数据删除</li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/18/Redis/" data-id="ckw4ypxug000064vmh8k4f5j8" data-title="Redis笔记" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/11/18/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/18/Redis/">Redis笔记</a>
          </li>
        
          <li>
            <a href="/2021/11/18/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>